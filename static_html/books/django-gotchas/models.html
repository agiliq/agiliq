
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Models &mdash; Django gotchas 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/base.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/minify.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Django gotchas 0.1 documentation" href="index.html" />
    <link rel="next" title="Templates" href="templates.html" />
    <link rel="prev" title="Forms" href="forms.html" /> 
  </head>
  <body>
    <div id="wrap">
        <div id="headerMeta"></div>
        <div id="header">
            <div class="container">
                <div class="sixteen columns">
                    <div class="logo">
                                <h1><a href="../../index.html"><img src="_static/logo.png" alt="Logo"/>
                                </a></h1>
                                <h2><div class="headertitle"><a href="index.html">Django gotchas 0.1 documentation</a></div></h2>
                    </div>
                </div>
            </div>
        </div>

        <div id="main_wrap">
            <div id="main">
                <div class="container">
            		<div class="twelve columns blog post main-content">
                        <div class="content no-img">
                            <div class="twelve columns omega">
                                    
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="models">
<h1>Models<a class="headerlink" href="models.html#models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="not-adding-a-max-length-to-models-charfield">
<h2>Not adding a max_length to models.CharField<a class="headerlink" href="models.html#not-adding-a-max-length-to-models-charfield" title="Permalink to this headline">¶</a></h2>
<p>If you do not add a max_length to CharFields your models will not validate.</p>
<p>Solution:</p>
<p>Add a max_length. If you want a field with unlimited length, use a TextField.</p>
</div>
<div class="section" id="adding-null-true-on-subclasses-of-charfield">
<h2>Adding null=True on subclasses of CharField<a class="headerlink" href="models.html#adding-null-true-on-subclasses-of-charfield" title="Permalink to this headline">¶</a></h2>
<p>Read <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/models/fields/#null">about null</a> to find out why null=True should not be used for CharField.
Often people keep this in mind but still use null=True on fields like EmailField, SlugField etc. Note that these fields are subclasses of
CharField and hence not making them as null applies to these fields too.</p>
</div>
<div class="section" id="not-handling-for-modelclass-doesnotexist-and-modelclass-multipleobjectsreturned">
<h2>Not handling for ModelClass.DoesNotExist and ModelClass.MultipleObjectsReturned<a class="headerlink" href="models.html#not-handling-for-modelclass-doesnotexist-and-modelclass-multipleobjectsreturned" title="Permalink to this headline">¶</a></h2>
<p>If you are doing a <cite>ModelClass.objects.get(this = that) unless you are doing it
for a unique key, this has a potential to raise `ModelClass.MultipleObjectsReturned</cite>
and <cite>ModelClass.DoesNotExist</cite>. This needs to be handled.</p>
<p>Solution:
If one of the query criteria is on an unique field, put it in a <cite>try: .. except ModelClass.DoesNotExits:..</cite>.
If there criteria has no unique field, handle both <cite>DoesNotExist</cite> and <cite>MultipleObjectsReturned</cite>.
In a view function use django.shortcuts.get_object_or_404(ModelClass, criteria = criteria)</p>
</div>
<div class="section" id="overriding-save">
<h2>Overriding .save()<a class="headerlink" href="models.html#overriding-save" title="Permalink to this headline">¶</a></h2>
<p>Most of the times you would be using <cite>model_obj.save()</cite> without any parameters,
so you may override <cite>.save</cite> as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ModelClass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>This would work until, <cite>.save</cite> is called with a parameter. For example,
when you use <cite>get_or_create</cite>, <cite>.save</cite> is called with as <cite>.save(force_insert = True)</cite>,
which will fail.</p>
<p>Solution:
Override save as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ModelClass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="trying-qs-get-foo">
<h2>Trying qs.get(&#8216;foo&#8217;)<a class="headerlink" href="models.html#trying-qs-get-foo" title="Permalink to this headline">¶</a></h2>
<p>Django <cite>.get</cite> and &#8216;.filter` takes only keywords argument. So <cite>ModelClass.objects.get(foo)</cite>
gives an error. Similarly creating objects as <cite>ModelClass(foo=foo)</cite> takes only
keyword arguments.</p>
<p>Solution:
Use keyword arguments.</p>
</div>
<div class="section" id="trying-to-use-an-stale-object">
<h2>Trying to use an stale object<a class="headerlink" href="models.html#trying-to-use-an-stale-object" title="Permalink to this headline">¶</a></h2>
<p>What is wrong with code?:</p>
<div class="highlight-python"><pre>def foo(req):
  obj =ModelClass.objects.get(pk = 5)
  magic(obj.pk)
  payload{'obj':obj}
  return render_to_response(template, payload, ..)</pre>
</div>
<p>Django does not have object identity, hence any change made to the database
within obj within <cite>magic</cite> won&#8217;t be available in the function.</p>
<p>Solution:
There is no easy solution to it, but you can keep
youself from being bitten by this behaviour. Pull objects close to
their use. Keep track of when an used object is updated and pull them again from
the database if updated.</p>
</div>
</div>


          </div>
        </div>
      </div>
                            </div>
                        </div>
                    </div>
                    <div class="four columns sidebar">
                        <div class="gce-widget">
                                <form method="get" action="search.html">
                                    <fieldset>
                                        <input id="q" class="search_input" type="text" name="q" value="search site" onclick="this.value='';" onfocus="javascript: if (formfield.defaultValue==formfield.value)formfield.value = ''" onblur="this.value=!this.value?'search site':this.value;" />
                                        <input class="submit" type="submit" value="Search" />
                                    </fieldset>
                                </form>
                        </div>
                        <div class="pages-widget">
                                <h3><a href="index.html">Table Of Contents</a></h3>
                                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="urls.html">Urls</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="forms.html">Forms</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="models.html">Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="models.html#not-adding-a-max-length-to-models-charfield">Not adding a max_length to models.CharField</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html#adding-null-true-on-subclasses-of-charfield">Adding null=True on subclasses of CharField</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html#not-handling-for-modelclass-doesnotexist-and-modelclass-multipleobjectsreturned">Not handling for ModelClass.DoesNotExist and ModelClass.MultipleObjectsReturned</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html#overriding-save">Overriding .save()</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html#trying-qs-get-foo">Trying qs.get(&#8216;foo&#8217;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html#trying-to-use-an-stale-object">Trying to use an stale object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contrib</a></li>
</ul>

                                    <h3 style="margin-top: 1.5em;">This Page</h3>
                                        <a href="_sources/models.txt" rel="nofollow">Show Source</a>
                        </div>
                    </div>
                    <div class="sixteen columns">
                        <div class="right">
                                    <a href="forms.html" title="Forms" accesskey="P">previous</a> |
                                    <a href="templates.html" title="Templates" accesskey="N">next</a> |
                                    <a href="genindex.html" title="General Index" accesskey="I">index</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer">
            <div class="container">
                <div class="four columns">
                    <div class="contact-widget">
                        <h4>Contact Us</h4>
                        <ul>
                            <li><span>Email :</span> <a href="mailto:hello@agiliq.com" class="test">hello@agiliq.com</a></li>
                            <li><span>Address :</span><p> Agiliq Info Solutions India Pvt Ltd,<br/>
                            # 302, Siri Sampada Appts,<br/>
                            Near Madhapur Police Station,<br/>
                            Hyderabad - 500033. India.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="four columns">
                    <div class="know-widget">
                        <h4>Know More</h4>
                        <ul>
                            <li> <a class="twitter" rel="nofollow" href="http://twitter.com/agiliqdotcom">Follow us on Twitter</a></li>
                            <li> <a class="facebook" rel="nofollow"  href="http://facebook.com/agiliq">Connect us on Facebook</a></li>
                            <li> <a class="linkedin" rel="nofollow" href="http://www.linkedin.com/company/agiliq-info-solutions-india-pvt-ltd">Linkedin</a></li>
                            <li><a class="youtube" rel="nofollow" href="http://www.youtube.com/user/agiliq">Youtube - Python Screencasts</a></li>
                            <li> <a class="posterous" rel="nofollow" href="http://people.agiliq.com/">Our Posterous</a></li>
                            <li> <a class="tumblr" rel="nofollow" href="http://agiliq.tumblr.com/">Our Tumblr</a></li>
                            <li> <a class="code" rel="nofollow" href="https://github.com/agiliq/">Code</a></li>
                        </ul>
                    </div>
                </div>
                <div class="four columns">
                    <div class="books-widget">
                        <h4>Read</h4>
                        <ul>
                            <li>
                                <a href="../../blog.1">Blog</a>
                            </li>
                            <li>
                                <a href="../../newsletter.1">Newsletter</a>
                            </li>
                            <li> <a href="../djangodesignpatterns/index.html">Django Design Patterns</a></li>
                            <li> <a href="../djenofdjango/index.html">Djen of Django</a></li>
                            <li> <a href="../djangogotchas/index.html">Django Gotchas</a></li>
                            <li> <a href="../../softwareconsulting.1">Software Consulting Howto</a></li>

                        </ul>
                    </div>
                </div>
               <div class="four columns">
                   <div class="links-widget">
                       <h4>About</h4>
                       <ul>
                           <li> <a href="../../index.html">Home</a></li>
                           <li> <a href="../../contact/index.html">Contact Us</a></li>
                           <li> <a href="../../whoweare">Who we are</a></li>
                           <li> <a href="../../whatwedo">What we do</a></li>

                           <li> <a href="../../blog.1">Blog</a></li>
                           <li> <a href="../../forum/index.html">Forum</a></li>

                       </ul>
                   </div>
               </div>
               <div class="copyright">
                        
    <div class="footer">
        &copy; Copyright 2009, Usware Technologies and Contributers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
               </div>
            </div>
        </div>
    </div>
    <!-- extra footer -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-367368-15']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>